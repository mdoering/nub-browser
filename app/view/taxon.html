<div id="name" class="page-header">
    <h1 ng-show="ctrl.tax.details" ng-class="{deleted: ctrl.tax.details.deleted}">{{ctrl.tax.details.scientificName}}
        <small>{{ctrl.tax.details.rank}}</small>
        <span ng-show="!ctrl.taxPrev.details" class="badge">new</span>
        <small style="float:right; margin-top:25px;"><a href="{{cfg.portal}}species/{{ctrl.key}}">gbif#{{ctrl.key}}</a></small>
    </h1>
    <h1 ng-show="!ctrl.tax.details">Not Existing</h1>
</div>


<div ng-show="ctrl.tax.details" class="row">
    <div class="col-md-5">
        <ul class="list-unstyled text-nowrap">
            <li style="margin-left:{{$index*10}}px" ng-repeat="tax in ctrl.tax.parents">
                <occ-change taxon="tax"></occ-change>
                <a href="#/taxon/{{tax.key}}">{{tax.canonicalName}}</a>
                <small>{{tax.rank}}</small>
            </li>
            <li style="margin-left:{{ctrl.tax.parents.length*10}}px">
                <occ-change taxon="ctrl.tax.details"></occ-change>
                <strong>{{ctrl.tax.details.canonicalName}}</strong>
                <small>{{ctrl.tax.details.rank}}</small>
            </li>
            <li style="margin-left:{{(ctrl.tax.parents.length+1)*10}}px" ng-repeat="tax in ctrl.tax.children">
                <occ-change taxon="tax"></occ-change>
                <taxon tax="tax"></taxon>
            </li>
        </ul>
    </div>

    <div class="col-md-7">
        <dl class="dl-horizontal">
            <dt>Status</dt>
            <dd>{{ctrl.tax.details.taxonomicStatus}} <span ng-show="ctrl.tax.details.acceptedKey>0"> OF </span><a href="#/taxon/{{ctrl.tax.details.acceptedKey}}">{{ctrl.tax.details.accepted}}</a></dd>

            <dt>Origin</dt>
            <dd>{{ctrl.tax.details.origin}} <a href="{{cfg.portal}}species/{{ctrl.tax.details.sourceTaxonKey}}">{{ctrl.tax.details.sourceTaxonKey}}</a></dd>

            <dt>Issues</dt>
            <dd ng-repeat="issue in ctrl.tax.details.issues">
                <small>{{issue}}</small>
            </dd>

            <dt>Published in</dt>
            <dd>{{ctrl.tax.details.publishedIn}}</dd>

            <dt>Basionym<span ng-show="ctrl.tax.combinations.length>0"> of</span></dt>
            <dd ng-show="ctrl.tax.details.basionymKey>0"><a href="#/taxon/{{ctrl.tax.details.basionymKey}}">{{ctrl.tax.details.basionym}}</a></dd>
            <dd ng-show="ctrl.tax.combinations.length>0">
                <ul class="list-unstyled">
                    <li ng-repeat="tax in ctrl.tax.combinations">
                        <a href="#/taxon/{{tax.key}}">{{tax.scientificName}}</a>
                    </li>
                </ul>
            </dd>

            <dt>Synonyms</dt>
            <dd>
                <ul class="list-unstyled">
                    <li ng-repeat="tax in ctrl.tax.synonyms">
                        <a href="#/taxon/{{tax.key}}">{{tax.scientificName}}</a>
                    </li>
                </ul>
            </dd>

            <dt>Occurrences</dt>
            <dd>{{ctrl.tax.details.occ | number}} <small ng-class="ctrl.tax.details.occRatioClass"><span ng-show="ctrl.tax.details.occ >= ctrl.tax.details.occPrev">+</span>{{ctrl.tax.details.occ - ctrl.tax.details.occPrev | number}}</small></dd>
        </dl>

        <leaflet height="360px" width="640px" layers="layers" defaults="defaults"></leaflet>

        <h4>Children by descendants</h4>
        <tree-map width="640" height="320" tree="ctrl.tax.children" event="children-retrieved" size-attr="size">
            Retrieving metrics ...
        </tree-map>

        <h4>Children by occurrences</h4>
        <tree-map width="640" height="320" tree="ctrl.tax.children" event="occ-counted" size-attr="occ" class-attr="occRatioClass">
            Retrieving occurrence metrics ...
        </tree-map>

<!--
-->
    </div>
</div>
